{{define "title"}}Request Player{{end}}

{{define "content"}}
<div class="content-container">
    <h2>Request Players</h2>

    {{if .SuccessCount}}
    <div class="notice notice-success">
        {{if eq .SuccessCount 1}}
        Your player request has been submitted and is pending commissioner approval.
        {{else}}
        {{.SuccessCount}} player requests have been submitted and are pending commissioner approval.
        {{end}}
    </div>
    {{end}}

    {{if not .HasTeams}}
    <div class="notice notice-warning">
        You must own a team to request a player. Contact a commissioner if you need team access.
    </div>
    {{else}}
    <p>Can't find a player in the database? Submit a request and a commissioner will review it.</p>

    <form action="/player/request" method="POST" class="standard-form">
        <input type="hidden" name="player_count" id="player_count" value="1">

        <div class="form-group">
            <label>League</label>
            <select name="league_id" required>
                <option value="">-- Select --</option>
                {{range .Leagues}}
                <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>
        </div>

        <div id="player-rows">
            <div class="player-row-entry" data-index="0">
                <div class="player-row-header">
                    <span class="player-row-label">Player #1</span>
                    <button type="button" class="button-remove" onclick="removePlayerRow(this)" style="display:none;">Remove</button>
                </div>
                <div class="player-fields-grid">
                    <div class="form-group">
                        <label for="first_name_0">First Name</label>
                        <input type="text" name="first_name_0" id="first_name_0" required placeholder="e.g. John">
                    </div>
                    <div class="form-group">
                        <label for="last_name_0">Last Name</label>
                        <input type="text" name="last_name_0" id="last_name_0" required placeholder="e.g. Smith">
                    </div>
                    <div class="form-group">
                        <label for="position_0">Position</label>
                        <select name="position_0" id="position_0" required>
                            <option value="">-- Select --</option>
                            <option value="C">C</option>
                            <option value="1B">1B</option>
                            <option value="2B">2B</option>
                            <option value="SS">SS</option>
                            <option value="3B">3B</option>
                            <option value="OF">OF</option>
                            <option value="DH">DH</option>
                            <option value="SP">SP</option>
                            <option value="RP">RP</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mlb_team_0">MLB Team</label>
                        <input type="text" name="mlb_team_0" id="mlb_team_0" required placeholder="e.g. NYY">
                    </div>
                </div>
                <div class="form-group ifa-check">
                    <input type="checkbox" name="is_ifa_0" id="is_ifa_0">
                    <label for="is_ifa_0">International Free Agent (IFA)</label>
                </div>
            </div>
        </div>

        <button type="button" class="button button-add" id="add-player-btn" onclick="addPlayerRow()">+ Add Another Player</button>

        <div class="form-group" style="margin-top: 20px;">
            <label>Notes (optional â€” applies to all players)</label>
            <textarea name="notes" rows="3" placeholder="e.g. Just drafted by Yankees in 2025 draft"></textarea>
        </div>

        <button type="submit" class="button button-primary">Submit Request</button>
    </form>
    {{end}}
</div>

<style>
    .content-container { max-width: 700px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .standard-form .form-group { margin-bottom: 20px; }
    .standard-form label { display: block; font-weight: bold; margin-bottom: 8px; }
    .standard-form input[type="text"], .standard-form textarea, .standard-form select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    .notice-success { background: #d4edda; color: #155724; padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #c3e6cb; }
    .notice-warning { background: #fff3cd; color: #856404; padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #ffeeba; }

    .player-row-entry { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 16px; margin-bottom: 12px; }
    .player-row-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .player-row-label { font-weight: bold; font-size: 0.95em; color: #2E6DA4; }
    .player-fields-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px 16px; }
    .player-fields-grid .form-group { margin-bottom: 0; }
    .ifa-check { display: flex; align-items: center; gap: 8px; margin-top: 10px; margin-bottom: 0 !important; }
    .ifa-check label { margin-bottom: 0 !important; font-weight: normal; }
    .ifa-check input[type="checkbox"] { width: auto; }

    .button-remove { background: #dc3545; color: white; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85em; }
    .button-remove:hover { background: #c82333; }
    .button-add { background: #f0f0f0; color: #333; border: 1px solid #ccc; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 0.9em; margin-top: 4px; margin-bottom: 8px; display: block; width: 100%; text-align: center; }
    .button-add:hover { background: #e0e0e0; }

    body.dark-mode .content-container { background: #152238 !important; }
    body.dark-mode .standard-form input[type="text"],
    body.dark-mode .standard-form textarea,
    body.dark-mode .standard-form select { background: #0D1B2A !important; color: #E8EDF2 !important; border-color: #2A3F5F !important; }
    body.dark-mode .notice-success { background: #1a3a2a !important; color: #7dcea0 !important; border-color: #2d6a4f !important; }
    body.dark-mode .notice-warning { background: #3a3520 !important; color: #f0c040 !important; border-color: #6a5a2f !important; }
    body.dark-mode .player-row-entry { background: #0D1B2A !important; border-color: #2A3F5F !important; }
    body.dark-mode .player-row-label { color: #00E5FF !important; }
    body.dark-mode .button-add { background: #1a2d47 !important; color: #E8EDF2 !important; border-color: #2A3F5F !important; }
    body.dark-mode .button-add:hover { background: #243a56 !important; }
    body.dark-mode .button-remove { background: #dc3545 !important; }
</style>

<script>
function addPlayerRow() {
    var container = document.getElementById('player-rows');
    var countInput = document.getElementById('player_count');
    var count = parseInt(countInput.value);
    if (count >= 10) return;

    var idx = count;
    var row = document.createElement('div');
    row.className = 'player-row-entry';
    row.setAttribute('data-index', idx);
    row.innerHTML =
        '<div class="player-row-header">' +
            '<span class="player-row-label">Player #' + (idx + 1) + '</span>' +
            '<button type="button" class="button-remove" onclick="removePlayerRow(this)">Remove</button>' +
        '</div>' +
        '<div class="player-fields-grid">' +
            '<div class="form-group">' +
                '<label for="first_name_' + idx + '">First Name</label>' +
                '<input type="text" name="first_name_' + idx + '" id="first_name_' + idx + '" required placeholder="e.g. John">' +
            '</div>' +
            '<div class="form-group">' +
                '<label for="last_name_' + idx + '">Last Name</label>' +
                '<input type="text" name="last_name_' + idx + '" id="last_name_' + idx + '" required placeholder="e.g. Smith">' +
            '</div>' +
            '<div class="form-group">' +
                '<label for="position_' + idx + '">Position</label>' +
                '<select name="position_' + idx + '" id="position_' + idx + '" required>' +
                    '<option value="">-- Select --</option>' +
                    '<option value="C">C</option>' +
                    '<option value="1B">1B</option>' +
                    '<option value="2B">2B</option>' +
                    '<option value="SS">SS</option>' +
                    '<option value="3B">3B</option>' +
                    '<option value="OF">OF</option>' +
                    '<option value="DH">DH</option>' +
                    '<option value="SP">SP</option>' +
                    '<option value="RP">RP</option>' +
                '</select>' +
            '</div>' +
            '<div class="form-group">' +
                '<label for="mlb_team_' + idx + '">MLB Team</label>' +
                '<input type="text" name="mlb_team_' + idx + '" id="mlb_team_' + idx + '" required placeholder="e.g. NYY">' +
            '</div>' +
        '</div>' +
        '<div class="form-group ifa-check">' +
            '<input type="checkbox" name="is_ifa_' + idx + '" id="is_ifa_' + idx + '">' +
            '<label for="is_ifa_' + idx + '">International Free Agent (IFA)</label>' +
        '</div>';

    container.appendChild(row);
    countInput.value = idx + 1;
    updateRowNumbers();
}

function removePlayerRow(btn) {
    var row = btn.closest('.player-row-entry');
    row.remove();
    reindexRows();
}

function reindexRows() {
    var rows = document.querySelectorAll('#player-rows .player-row-entry');
    for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        row.setAttribute('data-index', i);
        row.querySelector('.player-row-label').textContent = 'Player #' + (i + 1);

        var fields = [
            {name: 'first_name', tag: 'input'},
            {name: 'last_name', tag: 'input'},
            {name: 'position', tag: 'select'},
            {name: 'mlb_team', tag: 'input'},
            {name: 'is_ifa', tag: 'input'}
        ];
        for (var f = 0; f < fields.length; f++) {
            var el = row.querySelector('[name^="' + fields[f].name + '_"]');
            if (el) {
                el.name = fields[f].name + '_' + i;
                el.id = fields[f].name + '_' + i;
            }
            var lbl = row.querySelector('label[for^="' + fields[f].name + '_"]');
            if (lbl) {
                lbl.setAttribute('for', fields[f].name + '_' + i);
            }
        }
    }
    document.getElementById('player_count').value = rows.length;
    updateRowNumbers();
}

function updateRowNumbers() {
    var rows = document.querySelectorAll('#player-rows .player-row-entry');
    var addBtn = document.getElementById('add-player-btn');
    addBtn.style.display = rows.length >= 10 ? 'none' : 'block';
    for (var i = 0; i < rows.length; i++) {
        var removeBtn = rows[i].querySelector('.button-remove');
        if (removeBtn) {
            removeBtn.style.display = rows.length > 1 ? 'inline-block' : 'none';
        }
    }
}
</script>
{{end}}
