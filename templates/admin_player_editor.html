{{define "title"}}Player Editor{{end}}

{{define "content"}}
<h2>Master Player Editor</h2>

<div style="background: #f9f9f9; padding: 20px; margin-bottom: 30px; border-radius: 8px; border: 1px solid #ddd;">
    <form method="GET" action="/admin/player-editor" style="display: flex; gap: 10px; align-items: center;">
        <label><strong>Search Player by Name:</strong></label>
        <input type="text" name="q" placeholder="Enter name..." value="{{.SearchQuery}}" style="flex-grow: 1;">
        <button type="submit" class="button">Search</button>
        <a href="/admin/player-editor" class="button button-secondary">New Player</a>
    </form>

    {{if .SearchResults}}
    <div style="margin-top: 20px; background: white; border: 1px solid #eee; border-radius: 4px;">
        <table class="fantasy-table-base" style="margin: 0; border: none;">
            <thead>
                <tr>
                    <th style="background: #E87426; color: white;">League</th>
                    <th>Name</th>
                    <th>Pos</th>
                    <th>MLB Team</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {{range .SearchResults}}
                <tr>
                    <td><strong style="color: #E87426;">{{.LeagueName}}</strong></td>
                    <td>{{.FirstName}} {{.LastName}}</td>
                    <td>{{.Position}}</td>
                    <td>{{.MLBTeam}}</td>
                    <td><a href="/admin/player-editor?player_id={{.ID}}" class="button button-small">Edit Player</a></td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else if .SearchQuery}}
    <div style="margin-top: 20px; padding: 15px; background: #fff0f0; border: 1px solid #ffcccc; border-radius: 4px; color: #d9534f;">
        <strong>No players found matching "{{.SearchQuery}}".</strong>
    </div>
    {{end}}
</div>

{{if or .Player (not .SearchQuery)}}
<form method="POST" action="/admin/save-player">
    <input type="hidden" name="player_id" value="{{if .Player}}{{.Player.ID}}{{end}}">

    <div class="editor-grid">
        <div class="col card">
            <h3>1. Identity</h3>
            <label>First Name:</label>
            <input type="text" name="first_name" value="{{if .Player}}{{.Player.FirstName}}{{end}}" required>
            <label>Last Name:</label>
            <input type="text" name="last_name" value="{{if .Player}}{{.Player.LastName}}{{end}}" required>
            <label>Position:</label>
            <input type="text" name="position" value="{{if .Player}}{{.Player.Position}}{{end}}">
            <label>MLB Team:</label>
            <input type="text" name="mlb_team" value="{{if .Player}}{{.Player.MLBTeam}}{{end}}">
        </div>

        <div class="col card">
            <h3>2. Assignment</h3>
            <label>League:</label>
            <select name="league_id" required>
                <option value="">-- Select League --</option>
                {{$selectedLID := ""}}{{if .Player}}{{$selectedLID = .Player.LeagueID}}{{end}}
                {{range .Leagues}}
                <option value="{{.ID}}" {{if eq .ID $selectedLID}}selected{{end}}>{{.Name}}</option>
                {{end}}
            </select>
            
            <label>Fantasy Team ID (UUID):</label>
            <input type="text" name="team_id" value="{{if .Player}}{{.Player.TeamID}}{{end}}" placeholder="Paste Team UUID here...">
            <p style="font-size: 0.75rem; color: #888;">(Leave blank for Free Agent)</p>
        </div>

        <div class="col card">
            <h3>3. Status</h3>
            <label><input type="checkbox" name="status_40_man" {{if .Player}}{{if .Player.Status40Man}}checked{{end}}{{end}}> On 40-Man</label><br>
            <label><input type="checkbox" name="status_26_man" {{if .Player}}{{if .Player.Status26Man}}checked{{end}}{{end}}> On 26-Man</label><br><br>
            <label>IL Status:</label>
            <input type="text" name="status_il" value="{{if .Player}}{{.Player.StatusIL}}{{end}}" placeholder="e.g. 10-Day IL">
            <label>Option Years Used:</label>
            <input type="number" name="option_years" value="{{if .Player}}{{.Player.OptionYears}}{{end}}" min="0" max="3">
        </div>
    </div>

    <h3>4. Contracts (2026 - 2040)</h3>
    <div class="contract-grid">
        {{$p := .Player}}
        {{range $i := seq 2026 2040}}
        <div class="contract-input">
            <label>{{$i}}</label>
            <input type="text" name="contract_{{$i}}" value="{{if $p}}{{index $p.Contracts $i}}{{end}}">
        </div>
        {{end}}
    </div>

    <div style="margin-top: 40px; text-align: right; border-top: 1px solid #ddd; padding-top: 20px;">
        <button type="submit" class="button button-primary button-large">Save All Player Data</button>
    </div>
</form>
{{end}}

<style>
    .editor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px; }
    .card { background: white; border: 1px solid #ddd; padding: 20px; border-radius: 10px; }
    .contract-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; background: #fff; padding: 20px; border: 1px solid #ddd; border-radius: 10px; }
    .contract-input label { display: block; font-size: 0.75rem; font-weight: bold; color: #666; margin-bottom: 2px; }
    input[type=text], input[type=number], select { padding: 8px; margin-bottom: 10px; width: 100%; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
    .button-large { padding: 12px 30px; font-size: 1.1rem; }
</style>
{{end}}
